<h1 class="titleTextInterface text-application">Clockings</h1>

<br>

<ng-container *ngIf="isDesktop">
    <div class="row">
        <div class="col-md-5">
            <span class="text-application" style="font-size: large;">Total clocking late in {{ currentMonth }}&nbsp;{{ currentYear }}:&nbsp;
                <span *ngIf="sumClockingLate < 60 || !sumClockingLate">{{ totalClockingLate }}&nbsp;Min</span>
                <span *ngIf="sumClockingLate == 60 || sumClockingLate > 60">{{ totalClockingLateByHoursMinute }}</span>
            </span>
            <br *ngIf="showVacationLimitDays"><br *ngIf="showVacationLimitDays">
            <span *ngIf="showVacationLimitDays" class="text-application" style="font-size: large;">Vacation limit days in {{ currentMonthAndYearForVacation }}:&nbsp;
                <span *ngIf="vacationLimitDays" style="color: green;">{{ vacationLimitDays }}</span>
                <span *ngIf="!vacationLimitDays" style="color: red;">{{ vacationLimitDays }}</span>
                day(s)
            </span>
        </div>
        <div class="col-md-2">
            <mat-form-field class="text-application" style="width: 200px;">
                <mat-label>Month</mat-label>
                <mat-select name="monthSelected" class="text-application" [(ngModel)]="monthSelected" (selectionChange)="isDesktop ? getAllClockingsForDesktop() : getAllClockingsForTablet()">
                    <mat-option *ngFor="let month of monthsList" [value]="month.monthNbr">
                        <span class="text-application">{{month.monthName}}</span>
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </div>
        <div class="col-md-1"></div>
        <div class="col-md-2">
            <mat-form-field class="text-application" style="width: 200px;">
                <mat-label>Subject</mat-label>
                <mat-select name="subjectSelectedId" class="text-application" [(ngModel)]="subjectSelectedId" (selectionChange)="isDesktop ? getAllClockingsForDesktop() : getAllClockingsForTablet()">
                    <mat-option value=""></mat-option>
                    <mat-option *ngFor="let subject of subjectList" [value]="subject.id">
                        <span class="text-application">{{subject.subjectName}}</span>
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </div>
        <div class="col-md-2">
            <button 
                type="button" 
                (click)="newClocking()" 
                mat-mini-fab 
                style="background: #2196F3;float: right;">
                <mat-icon style="color: white;">add</mat-icon>
            </button>
        </div> 
    </div>
</ng-container>

<ng-container *ngIf="isTablet">
    <div class="row">
        <div class="col-md-4">
            <mat-form-field class="text-application" style="width: 200px;">
                <mat-label>Month</mat-label>
                <mat-select name="monthSelected" class="text-application" [(ngModel)]="monthSelected" (selectionChange)="isDesktop ? getAllClockingsForDesktop() : getAllClockingsForTablet()">
                    <mat-option *ngFor="let month of monthsList" [value]="month.monthNbr">
                        <span class="text-application">{{month.monthName}}</span>
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </div>
        <div class="col-md-4">
            <mat-form-field class="text-application" style="width: 200px;">
                <mat-label>Subject</mat-label>
                <mat-select name="subjectSelectedId" class="text-application" [(ngModel)]="subjectSelectedId" (selectionChange)="isDesktop ? getAllClockingsForDesktop() : getAllClockingsForTablet()">
                    <mat-option value=""></mat-option>
                    <mat-option *ngFor="let subject of subjectList" [value]="subject.id">
                        <span class="text-application">{{subject.subjectName}}</span>
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </div>
        <div class="col-md-4">
            <button 
                type="button" 
                (click)="newClocking()" 
                mat-mini-fab 
                style="background: #2196F3;float: right;">
                <mat-icon style="color: white;">add</mat-icon>
            </button>
        </div>     
    </div>
    <br>
    <div class="row">
        <div class="col-md-6">
            <span class="text-application" style="font-size: initial;">
                Total clocking late in {{ currentMonth }}&nbsp;{{ currentYear }}:&nbsp;
                <span *ngIf="sumClockingLate < 60 || !sumClockingLate">{{ totalClockingLate }}&nbsp;Min</span>
                <span *ngIf="sumClockingLate == 60 || sumClockingLate > 60">{{ totalClockingLateByHoursMinute }}</span>
            </span>
        </div>
        <div class="col-md-6">
            <span *ngIf="showVacationLimitDays" class="text-application" style="font-size: initial;">
                Vacation limit days in {{ currentMonthAndYearForVacation }}:&nbsp;
                <span *ngIf="vacationLimitDays" style="color: green;">{{ vacationLimitDays }}</span>
                <span *ngIf="!vacationLimitDays" style="color: red;">{{ vacationLimitDays }}</span>
                day(s)
            </span>
        </div>
    </div>
</ng-container>

<br>

<div [ngClass]="isDesktop ? 'mat-elevation-z8' : 'row'">

    <ng-container *ngIf="isDesktop">
        <table mat-table [dataSource]="dataSource">

            <ng-container matColumnDef="date">
                <th mat-header-cell *matHeaderCellDef class="text-application" style="color: white; width: 200px;">Date</th>
                <td mat-cell *matCellDef="let element" class="text-application" style="text-align: center;width: 200px;">{{ element.dateClocking | date:'dd/MM/yyyy' }}</td>
            </ng-container>
    
            <ng-container matColumnDef="day">
                <th mat-header-cell *matHeaderCellDef class="text-application" style="color: white; width: 200px;">Day</th>
                <td mat-cell *matCellDef="let element" class="text-application" style="text-align: center;width: 200px;">{{ element.day }}</td>
            </ng-container>
    
            <ng-container matColumnDef="time">
                <th mat-header-cell *matHeaderCellDef class="text-application" style="color: white; width: 200px;">Time</th>
                <td mat-cell *matCellDef="let element" class="text-application" style="text-align: center; width: 200px;">
                    <span *ngIf="element.timeClocking">{{ element.timeClocking }}</span>
                    <span *ngIf="!element.timeClocking">-</span>
                </td>
            </ng-container>
    
            <ng-container matColumnDef="clockingNbr">
                <th mat-header-cell *matHeaderCellDef class="text-application" style="color: white;  width: 200px;">Clocking Nbr</th>
                <td mat-cell *matCellDef="let element" class="text-application" style="text-align: center;  width: 200px;">
                    <span *ngIf="element.clockingNbr">{{ element.clockingNbr }}</span>
                    <span *ngIf="!element.clockingNbr">-</span>
                </td>
            </ng-container>
    
            <ng-container matColumnDef="note">
                <th mat-header-cell *matHeaderCellDef class="text-application" style="color: white;">Note</th>
                <td mat-cell *matCellDef="let element" class="text-application" style="text-align: center;">
                    <span *ngIf="element.note">{{ element.note }}</span>
                    <span *ngIf="!element.note">-</span>
                </td>
            </ng-container>

            <ng-container matColumnDef="star">
                <th mat-header-cell *matHeaderCellDef> </th>
                <td mat-cell *matCellDef="let element"> 
                    <button mat-icon-button [matMenuTriggerFor]="contextMenu" [matMenuTriggerData]="{element:element}">
                        <mat-icon>more_vert</mat-icon>
                    </button>
                </td>
            </ng-container>
        
            <tr mat-header-row style="background: #2196F3;" *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row style="border-bottom: 1px solid black;" *matRowDef="let row; columns: displayedColumns;"></tr>
    
        </table>
    </ng-container>

    <ng-container *ngIf="isTablet">
        <div *ngFor="let clocking of pagedList" class="mx-auto my-3 col-md-4">
            <mat-card class="text-application example-card-tablet">
                <mat-card-header style="height: 80px;">
                    <mat-card-title style="margin-top: 20px;font-size: larger;">{{ clocking.dateClocking | date:'dd/MM/yyyy' }}</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                    <mat-grid-list cols="12">
                        <mat-grid-tile colspan="4">Day</mat-grid-tile>             
                        <mat-grid-tile colspan="8"><span>{{ clocking.day }}</span></mat-grid-tile><br>

                        <mat-grid-tile colspan="4">Time</mat-grid-tile>                
                        <mat-grid-tile colspan="8">
                            <span *ngIf="clocking.timeClocking">{{ clocking.timeClocking }}</span>
                            <span *ngIf="!clocking.timeClocking">-</span>
                        </mat-grid-tile><br>

                        <mat-grid-tile colspan="4">Nbr</mat-grid-tile>                
                        <mat-grid-tile colspan="8">
                            <span *ngIf="clocking.clockingNbr">{{ clocking.clockingNbr }}</span>
                            <span *ngIf="!clocking.clockingNbr">-</span>
                        </mat-grid-tile><br>
                        
                        <mat-grid-tile colspan="4">Note</mat-grid-tile>                
                        <mat-grid-tile colspan="8">
                            <mat-icon *ngIf="clocking.note" style="color: black;" (click)="viewNote(clocking.note)">note</mat-icon>         
                            <i *ngIf="!clocking.note" class="fa fa-minus-circle" aria-hidden="true"></i>
                        </mat-grid-tile>
                    </mat-grid-list>
                </mat-card-content>
                <mat-card-actions>
                    <div class="row justify-content-center">           
                        <mat-icon 
                            style="color: #9C27B0; margin-right: 10%;"
                            aria-label="Edit"
                            (click)="editClocking(clocking)">
                            edit
                        </mat-icon>
                        <mat-icon 
                            style="color: #f44336;"
                            (click)="deleteClocking(clocking.key)">
                            delete
                        </mat-icon>
                    </div>
                </mat-card-actions>       
            </mat-card>
        </div>
    </ng-container>

    <div *ngIf="isDesktop" class="row justify-content-center no-results text-application" [style.display]="dataSource.data.length == 0 ? '' : 'none'">
        No results
    </div>

    <mat-paginator
        *ngIf="isDesktop"
        [pageSize]="8 "
        [pageSizeOptions]="[8]"
        showFirstLastButtons>
    </mat-paginator>
</div>

<div *ngIf="isTablet" class="row justify-content-center no-results text-application" [style.display]="pagedList.length == 0 ? '' : 'none'">
    No results
</div>

<div class="row mat-paginator" *ngIf="isTablet">
    <mat-paginator 
        [length]="length"
        [pageSize]="6"
        [pageSizeOptions]="[6]"
        showFirstLastButtons
        (page)="OnPageChange($event)">
    </mat-paginator>
</div>

<div style="visibility: hidden; position: fixed"
  [style.left]="contextMenuPosition.x"
  [style.top]="contextMenuPosition.y"
  [matMenuTriggerFor]="contextMenu">
</div>

<mat-menu #contextMenu="matMenu" xPosition="before">
	<ng-template matMenuContent let-clocking="element">

        <button
            type="button"
            mat-menu-item 
            (click)="editClocking(clocking)"
            class="text-application">
            <mat-icon style="color: #9C27B0" aria-label="Edit">edit</mat-icon>
            <span>Edit</span>
        </button>

        <button
            type="button"
            mat-menu-item 
            (click)="deleteClocking(clocking.key)"
            class="text-application">
            <mat-icon style="color: #f44336;">delete</mat-icon>
            <span>Delete</span>
        </button>  

	</ng-template>
</mat-menu>