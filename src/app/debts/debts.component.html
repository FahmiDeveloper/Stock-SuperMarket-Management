<h1 class="titleTextInterface text-application">Debts</h1>

<br>

<div class="row">
    <div class="col-md-12">
        <button
            *ngIf="dataUserConnected.roleAddDebt"
            type="button" 
            (click)="newDebt()" 
            mat-mini-fab 
            color="primary" 
            style="background: #2196F3;float: right;">
            <mat-icon style="color: white;">add</mat-icon>
        </button>

        <button 
            *ngIf="!sortByDesc"
            type="button"  
            mat-mini-fab 
            color="primary" 
            (click)="sortByRefDebtDesc()" 
            style="background: #2196F3;float: right;margin-right: 10px;">
            <mat-icon style="color: white;" aria-label="Example icon-button with a heart icon">sort</mat-icon>
        </button>&nbsp;&nbsp;

        <button 
            *ngIf="sortByDesc"
            type="button"
            mat-mini-fab
            color="primary" 
            (click)="sortByRefDebtAsc()" 
            style="background: #2196F3;float: right;margin-right: 10px;">
            <mat-icon style="color: white;" aria-label="Example icon-button with a heart icon">sort</mat-icon>
        </button>

    </div> 
</div>

<br>

<div class="row">
    <div class="col-md-4">
        <mat-form-field class="widhtInput text-application">
            <mat-label>Note</mat-label>
            <input matInput type="text" name="queryNote" (keyup)="getAllDebts()" [(ngModel)]="queryNote"/>
        </mat-form-field>
    </div>
    <div class="col-md-4">
        <mat-form-field class="text-application" style="width: 285px;">
            <mat-label>Place</mat-label>
			<mat-select name="placeId" [(ngModel)]="placeId" (selectionChange)="getAllDebts()">
                <mat-option value=""></mat-option>
				<mat-option *ngFor="let placeMoney of placesMoney" [value]="placeMoney.id">
                    {{placeMoney.place}}
				</mat-option>
			</mat-select>
		</mat-form-field>
    </div>
    <div class="col-md-2">
        <button mat-flat-button color="primary" (click)="showRest(contentRestMoneyForeachPlace)" class="text-application">Rest</button>
    </div>
    <div class="col-md-2">
        <button 
            *ngIf="(dataSource.data.length) && (dataSource.data.length > 1) && placeId" [hidden]="placeId == 5"
            mat-flat-button 
            color="warn" 
            (click)="deleteAllByPlace(contentLoading)"
            class="text-application">
            Delete all
        </button>
    </div>
</div>

<br>

<div *ngIf="placeId == 1">
    <mat-grid-list cols="6" rowHeight="5:1" style="font-size: 20px;">
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile class="text-application" style="color: #dc3545;">{{ restInPocket }}</mat-grid-tile>
        <mat-grid-tile>: الجيب</mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
    </mat-grid-list>
</div>

<div *ngIf="placeId == 2">
    <mat-grid-list cols="6" rowHeight="5:1" style="font-size: 20px;">
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile class="text-application" style="color: #dc3545;">{{ restInWallet }}</mat-grid-tile>
        <mat-grid-tile>: المحفظة</mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
    </mat-grid-list>
</div>

<div *ngIf="placeId == 3">
    <mat-grid-list cols="6" rowHeight="5:1" style="font-size: 20px;">
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile class="text-application" style="color: #dc3545;">{{ restInEnvelope }}</mat-grid-tile>
        <mat-grid-tile>: الظرف</mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
    </mat-grid-list>
</div>

<div *ngIf="placeId == 4">
    <mat-grid-list cols="6" rowHeight="5:1" style="font-size: 20px;">
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile class="text-application" style="color: #dc3545;">{{ restInBox }}</mat-grid-tile>
        <mat-grid-tile>: الصندوق</mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
    </mat-grid-list>
</div>

<div *ngIf="placeId == 5">
    <mat-grid-list cols="8" rowHeight="5:1" style="font-size: 20px;">
        
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile>الدين المسال</mat-grid-tile>
        <mat-grid-tile>
            <mat-checkbox 
                name="getOutDebt" 
                [(ngModel)]="getOutDebt" 
                (ngModelChange)="showOutDebt()">
            </mat-checkbox>
        </mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile>الدين المتخلد</mat-grid-tile>
        <mat-grid-tile>
            <mat-checkbox 
                name="getInDebt" 
                [(ngModel)]="getInDebt"         
                (ngModelChange)="showInDebt()">
            </mat-checkbox>
        </mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        
    </mat-grid-list>

    <br>

    <div class="row text-application" *ngIf="getInDebt || getOutDebt">
        <div class="col-md-3"></div>
        <div class="col-md-6">
            <mat-card class="text-application">
                <mat-grid-list cols="2" rowHeight="4:1">
                    <mat-grid-tile>
                        <span style="font-size: 20px;">
                            <span *ngIf="getInDebt">
                                <span *ngIf="totalInDebts">{{ totalInDebts }}</span>
                                <span *ngIf="!totalInDebts">0DT</span>
                            </span>
                            <span *ngIf="getOutDebt">
                                <span *ngIf="totalOutDebts">{{ totalOutDebts }}</span>
                                <span *ngIf="!totalOutDebts">0DT</span>
                            </span>  
                        </span>    
                    </mat-grid-tile>
                    <mat-grid-tile><span style="font-size: 20px;">المجموع</span></mat-grid-tile>

                    <mat-grid-tile>
                        <mat-form-field>
                            <mat-label>وقت الدفع</mat-label>
                            <mat-select *ngIf="getInDebt" name="statusInDebtId" [(ngModel)]="statusInDebtId" (selectionChange)="getTotalInDebtsByStatus()" class="text-application">
                                <mat-option value=""></mat-option>
                                <mat-option *ngFor="let statusInDebt of statusInDebts" [value]="statusInDebt.id">
                                    <span class="text-application">{{statusInDebt.status}}</span>
                                </mat-option>
                            </mat-select>

                            <mat-select *ngIf="getOutDebt" name="statusOutDebtId" [(ngModel)]="statusOutDebtId" (selectionChange)="getTotalOutDebtsByStatus()" class="text-application">
                                <mat-option value=""></mat-option>
                                <mat-option *ngFor="let statusOutDebt of statusOutDebts" [value]="statusOutDebt.id">
                                    <span class="text-application">{{statusOutDebt.status}}</span>
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </mat-grid-tile>
                    <mat-grid-tile><span style="font-size: 20px;">وقت الدفع</span></mat-grid-tile>

                    <mat-grid-tile>
                        <mat-form-field>
                            <mat-select *ngIf="getInDebt" name="creditorName" [(ngModel)]="creditorName" (selectionChange)="getTotalInDebtsByCreditor()" class="text-application">
                                <mat-option value=""></mat-option>
                                <mat-option *ngFor="let creditor of creditors" [value]="creditor">
                                    <span class="text-application">{{creditor}}</span>
                                </mat-option>
                            </mat-select>

                            <mat-select *ngIf="getOutDebt" name="debtorName" [(ngModel)]="debtorName" (selectionChange)="getTotalOutDebtsByDebtor()" class="text-application">
                                <mat-option value=""></mat-option>
                                <mat-option *ngFor="let debtor of debtors" [value]="debtor">
                                    <span class="text-application">{{debtor}}</span>
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </mat-grid-tile>
                    <mat-grid-tile>
                        <span *ngIf="getInDebt" style="font-size: 20px;">الدائنين</span>
                        <span *ngIf="getOutDebt" style="font-size: 20px;">المدينين</span>
                    </mat-grid-tile>

                    <mat-grid-tile *ngIf="statusInDebtId || statusOutDebtId || creditorName || debtorName">
                        <span *ngIf="statusInDebtId || creditorName" style="font-size: 20px;">
                            <span *ngIf="totalInDebtsByCreditor">{{ totalInDebtsByCreditor }}</span>
                            <span *ngIf="!totalInDebtsByCreditor">0DT</span>
                        </span>                  
                        <span *ngIf="statusOutDebtId || debtorName" style="font-size: 20px;">
                            <span *ngIf="totalOutDebtsByDebtor">{{ totalOutDebtsByDebtor }}</span>
                            <span *ngIf="!totalOutDebtsByDebtor">0DT</span>
                        </span>     
                    </mat-grid-tile>
                    <mat-grid-tile *ngIf="statusInDebtId || statusOutDebtId || creditorName || debtorName">
                        <span style="font-size: 20px;">الدين</span>
                    </mat-grid-tile>
                  </mat-grid-list>
            </mat-card>
        </div>
        <div class="col-md-3"></div>
    </div>
</div>

<div *ngIf="placeId == 6">
    <mat-grid-list cols="6" rowHeight="5:1" style="font-size: 20px;">
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile class="text-application" style="color: #dc3545;">{{ restInPosteAccount }}</mat-grid-tile>
        <mat-grid-tile>: الحساب البريدي</mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
    </mat-grid-list>
</div>

<br>

<div class="mat-elevation-z8">
    <table mat-table [dataSource]="dataSource">

        <ng-container matColumnDef="debtor">
            <th mat-header-cell *matHeaderCellDef class="text-application" style="color: white;">Debtor</th>
            <td mat-cell *matCellDef="let element" class="text-application" style="text-align: center;">
                <span *ngIf="element.debtor">{{ element.debtor }}</span>
                <span *ngIf="!element.debtor">-</span>
            </td>
        </ng-container>

        <ng-container matColumnDef="creditor">
            <th mat-header-cell *matHeaderCellDef class="text-application" style="color: white;">Creditor</th>
            <td mat-cell *matCellDef="let element" class="text-application" style="text-align: center;">
                <span *ngIf="element.creditor">{{ element.creditor }}</span>
                <span *ngIf="!element.creditor">-</span>
            </td>
        </ng-container>

        <ng-container matColumnDef="debt">
            <th mat-header-cell *matHeaderCellDef class="text-application" style="color: white;">Debt</th>
            <td mat-cell *matCellDef="let element" class="text-application" style="text-align: center;">
                <span *ngIf="element.financialDebt">{{ element.financialDebt }}</span>
                <span *ngIf="!element.financialDebt">-</span>
            </td>
        </ng-container>

        <ng-container matColumnDef="rest">
            <th mat-header-cell *matHeaderCellDef class="text-application" style="color: white;">Rest</th>
            <td mat-cell *matCellDef="let element" class="text-application" style="text-align: center;">
                <span *ngIf="element.restMoney">{{ element.restMoney }}</span>
                <span *ngIf="!element.restMoney">-</span>
            </td>
        </ng-container>

        <ng-container matColumnDef="details">
            <th mat-header-cell *matHeaderCellDef class="text-application" style="color: white;">Details</th>
            <td mat-cell *matCellDef="let element" (contextmenu)="onContextMenu($event, element)">
                <div style="margin-top: 50px;margin-bottom: 50px;">
                    <div class="gridForLegend text-application">
                        <div><span>Date:</span></div>
                        <div>{{ element.date | date:'dd/MM/yyyy' }}</div>
                    </div>
                    <br>
                    <div class="gridForLegend text-application">
                        <div><span>Place:</span></div>
                        <div>{{ element.place }}</div>
                    </div>
                    <br>
                    <div class="gridForLegend text-application">
                        <div><span>Status:</span></div>
                        <div>
                            <span *ngIf="element.placeId === 5">
                                <span *ngIf="element.toPayThisMonth">Pay this month</span>
                                <span *ngIf="element.toPayNextMonth">Pay next month</span>
                                <span *ngIf="element.notToPayForNow">Pay will be delayed</span>
                                <span *ngIf="element.toGetThisMonth">Get this month</span>
                                <span *ngIf="element.toGetNextMonth">Get next month</span>
                                <span *ngIf="element.notToGetForNow">Get will be delayed</span>
                            </span>
                            <span *ngIf="element.placeId !== 5">-</span>
                        </div>
                    </div>
                    <br>
                    <div class="gridForLegend text-application">
                        <div><span>Note:</span></div>
                        <div>{{ element.note }}</div>
                    </div> 
                </div>
                
            </td>
        </ng-container>
    
        <tr mat-header-row style="background: #ff4081;" *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row style="border-bottom: 1px solid black;"  *matRowDef="let row; columns: displayedColumns;"></tr>

    </table>

    <div class="no-results text-application" [style.display]="dataSource.data.length == 0 ? '' : 'none'">
        No results
    </div>
    
    <mat-paginator 
        [pageSizeOptions]="[8]"
        showFirstLastButtons 
        aria-label="Select page of periodic elements">
    </mat-paginator>
</div>

<div style="visibility: hidden; position: fixed"
  [style.left]="contextMenuPosition.x"
  [style.top]="contextMenuPosition.y"
  [matMenuTriggerFor]="contextMenu">
</div>

<mat-menu #contextMenu="matMenu">
	<ng-template matMenuContent let-debt="debt">

        <button 
            *ngIf="dataUserConnected.roleUpdateDebt"  
            type="button" 
            mat-menu-item 
            (click)="editDebt(debt)">
            <mat-icon style="color: #9C27B0" aria-label="Edit">edit</mat-icon>
            <span>Edit</span>
        </button>

        <button
            *ngIf="dataUserConnected.roleDeleteDebt" 
            type="button"
            mat-menu-item 
            (click)="openDeleteDebtModal(debt, contentDeleteDebt)" 
            class="text-application">
            <mat-icon style="color: #f44336;">delete</mat-icon>
            <span>Delete</span>
        </button>

	</ng-template>
</mat-menu>


<ng-template #contentRestMoneyForeachPlace>

    <div mat-dialog-title class="dialog-title">
        <h2 class="text-application">Rest Money</h2>
        <button mat-icon-button aria-label="close dialog" mat-dialog-close>
          <mat-icon>close</mat-icon>
        </button>
    </div>

    <mat-grid-list cols="2" rowHeight="4:1" class="text-application" style="font-size: 20px;">
        <mat-grid-tile>{{ restInPocket }}</mat-grid-tile>
        <mat-grid-tile>: الجيب</mat-grid-tile>
    </mat-grid-list>
    
    <br>
    <mat-divider></mat-divider>
    <br>
    
    <mat-grid-list cols="2" rowHeight="4:1" class="text-application" style="font-size: 20px;">
        <mat-grid-tile>{{ restInWallet }}</mat-grid-tile>
        <mat-grid-tile>: المحفظة</mat-grid-tile>
    </mat-grid-list>

    <br>
    <mat-divider></mat-divider>
    <br>
    
    <mat-grid-list cols="2" rowHeight="4:1" class="text-application" style="font-size: 20px;">
        <mat-grid-tile>{{ restInEnvelope }}</mat-grid-tile>
        <mat-grid-tile>: الظرف</mat-grid-tile>
    </mat-grid-list>

    <br>
    <mat-divider></mat-divider>
    <br>
    
    <mat-grid-list cols="2" rowHeight="4:1" class="text-application" style="font-size: 20px;">
        <mat-grid-tile>{{ restInBox }}</mat-grid-tile>
        <mat-grid-tile>: الصندوق</mat-grid-tile>
    </mat-grid-list>

    <br>
    <mat-divider></mat-divider>
    <br>
    
    <mat-grid-list cols="2" rowHeight="4:1" class="text-application" style="font-size: 20px;">
        <mat-grid-tile>{{ restInPosteAccount }}</mat-grid-tile>
        <mat-grid-tile>: الحساب البريدي</mat-grid-tile>
    </mat-grid-list>

</ng-template>



<ng-template #contentLoading>

    <div mat-dialog-title class="dialog-title">
        <h2 class="text-application">Delete debts</h2>
        <button mat-icon-button aria-label="close dialog" mat-dialog-close>
          <mat-icon>close</mat-icon>
        </button>
    </div>
  
    <div class="modal-body text-application">
      <div *ngIf="isLoading">
        <mat-spinner style="margin-left:100px; margin-top: 30px;"></mat-spinner><br>
        <h3 class="text-application" style="text-align: center;">Delete debts in progress...</h3>
      </div>
    </div>
</ng-template>

<ng-template #contentDeleteDebt>

    <div mat-dialog-title class="dialog-title">
      <h2 class="text-application">Are you sure ?</h2>
    </div>
  
    <div mat-dialog-content>
        <div class="gridForDelete text-application">
            <div><span>Debtor:</span></div>
            <div>
                <span *ngIf="debtToDelete.debtor">{{ debtToDelete.debtor }}</span>
                <span *ngIf="!debtToDelete.debtor">-</span>
            </div>
        </div>
        <br>
        <div class="gridForDelete text-application">
            <div><span>Creditor:</span></div>
            <div>
                <span *ngIf="debtToDelete.creditor">{{ debtToDelete.creditor }}</span>
                <span *ngIf="!debtToDelete.creditor">-</span>
            </div>
        </div>
        <br>
        <div class="gridForDelete text-application">
            <div><span>Debt:</span></div>
            <div>
                <span *ngIf="debtToDelete.financialDebt">{{ debtToDelete.financialDebt }}</span>
                <span *ngIf="!debtToDelete.financialDebt">-</span>
            </div>
        </div>
        <br>
        <div class="gridForDelete text-application">
            <div><span>Rest:</span></div>
            <div>
                <span *ngIf="debtToDelete.restMoney">{{ debtToDelete.restMoney }}</span>
                <span *ngIf="!debtToDelete.restMoney">-</span>
            </div>
        </div> 
        <br>
        <div class="gridForDelete text-application">
            <div><span>Date:</span></div>
            <div>{{ debtToDelete.date | date:'dd/MM/yyyy' }}</div>
        </div> 
        <br>
        <div class="gridForDelete text-application">
            <div><span>Place:</span></div>
            <div>{{ debtToDelete.place }}</div>
        </div> 
        <br>
        <div class="gridForDelete text-application">
            <div><span>Status:</span></div>
            <div>
                <span *ngIf="debtToDelete.placeId === 5">
                    <span *ngIf="debtToDelete.toPayThisMonth">Pay this month</span>
                    <span *ngIf="debtToDelete.toPayNextMonth">Pay next month</span>
                    <span *ngIf="debtToDelete.notToPayForNow">Pay will be delayed</span>
                    <span *ngIf="debtToDelete.toGetThisMonth">Get this month</span>
                    <span *ngIf="debtToDelete.toGetNextMonth">Get next month</span>
                    <span *ngIf="debtToDelete.notToGetForNow">Get will be delayed</span>
                </span>
                <span *ngIf="debtToDelete.placeId !== 5">-</span>
            </div>
        </div> 
        <br>
        <div class="gridForDelete text-application">
            <div><span>Note:</span></div>
            <div>{{ debtToDelete.note }}</div>
        </div> 
    </div>

    <br>

    <div class="row justify-content-center" mat-dialog-actions>
        <button 
            mat-button 
            type="button" 
            [mat-dialog-close]="1" 
            (click)="confirmDelete()" 
            style="background:rgb(221, 51, 51);color: white;" 
            class="text-application">
            Delete
        </button>

        <button 
            mat-button 
            type="button" 
            (click)="close()" 
            tabindex="-1" 
            style="background:#607D8B;color: white;" 
            class="text-application">
            Cancel
        </button>
    </div>
  
</ng-template>