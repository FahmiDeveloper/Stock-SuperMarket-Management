<h1 class="titleTextInterface text-application">Debts</h1>

<br>
<br>

<div class="row">
    <div class="col-md-4">
        <mat-form-field class="widhtInput">
            <mat-label>Note</mat-label>
            <input matInput type="text" name="queryNote" (keyup)="getAllDebts()" [(ngModel)]="queryNote"/>
        </mat-form-field>
    </div>
    <div class="col-md-4">
        <mat-form-field style="width: 285px;">
            <mat-label>Place</mat-label>
			<mat-select name="placeId" [(ngModel)]="placeId" (selectionChange)="getAllDebts()">
                <mat-option value=""></mat-option>
				<mat-option *ngFor="let placeMoney of placesMoney" [value]="placeMoney.id">
                    {{placeMoney.place}}
				</mat-option>
			</mat-select>
		</mat-form-field>
    </div>
    <div class="col-md-2">
        <button mat-flat-button color="primary" (click)="showRest(contentRestMoneyForeachPlace)">Rest</button>
    </div>
    <div class="col-md-2">
        <button 
            *ngIf="(dataSource.data.length) && (dataSource.data.length > 1) && placeId" [hidden]="placeId == 5"
            mat-flat-button 
            color="warn" 
            (click)="deleteAllByPlace(contentLoading)">
            Delete all
        </button>
    </div>
</div>

<br>

<div *ngIf="placeId == 1">
    <mat-grid-list cols="6" rowHeight="5:1" style="font-size: 20px;">
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile style="color: #dc3545;">{{ restInPocket }}</mat-grid-tile>
        <mat-grid-tile>: الجيب</mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
    </mat-grid-list>
</div>

<div *ngIf="placeId == 2">
    <mat-grid-list cols="6" rowHeight="5:1" style="font-size: 20px;">
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile style="color: #dc3545;">{{ restInWallet }}</mat-grid-tile>
        <mat-grid-tile>: المحفظة</mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
    </mat-grid-list>
</div>

<div *ngIf="placeId == 3">
    <mat-grid-list cols="6" rowHeight="5:1" style="font-size: 20px;">
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile style="color: #dc3545;">{{ restInEnvelope }}</mat-grid-tile>
        <mat-grid-tile>: الظرف</mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
    </mat-grid-list>
</div>

<div *ngIf="placeId == 4">
    <mat-grid-list cols="6" rowHeight="5:1" style="font-size: 20px;">
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile style="color: #dc3545;">{{ restInBox }}</mat-grid-tile>
        <mat-grid-tile>: الصندوق</mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
    </mat-grid-list>
</div>

<div *ngIf="placeId == 5">
    <mat-grid-list cols="8" rowHeight="5:1" style="font-size: 20px;">
        
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile>الدين المسال</mat-grid-tile>
        <mat-grid-tile>
            <mat-checkbox 
                name="getOutDebt" 
                [(ngModel)]="getOutDebt" 
                (ngModelChange)="showOutDebt()">
            </mat-checkbox>
        </mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile>الدين المتخلد</mat-grid-tile>
        <mat-grid-tile>
            <mat-checkbox 
                name="getInDebt" 
                [(ngModel)]="getInDebt"         
                (ngModelChange)="showInDebt()">
            </mat-checkbox>
        </mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        
    </mat-grid-list>

    <br>

    <div class="row text-application" *ngIf="getInDebt || getOutDebt">
        <div class="col-md-3"></div>
        <div class="col-md-6">
            <mat-card>
                <mat-grid-list cols="2" rowHeight="4:1">
                    <mat-grid-tile>
                        <span style="font-size: 20px;">
                            <span *ngIf="getInDebt">
                                <span *ngIf="totalInDebts">{{ totalInDebts }}</span>
                                <span *ngIf="!totalInDebts">0DT</span>
                            </span>
                            <span *ngIf="getOutDebt">
                                <span *ngIf="totalOutDebts">{{ totalOutDebts }}</span>
                                <span *ngIf="!totalOutDebts">0DT</span>
                            </span>  
                        </span>    
                    </mat-grid-tile>
                    <mat-grid-tile><span style="font-size: 20px;">المجموع</span></mat-grid-tile>

                    <mat-grid-tile>
                        <mat-form-field>
                            <mat-label>وقت الدفع</mat-label>
                            <mat-select *ngIf="getInDebt" name="statusInDebtId" [(ngModel)]="statusInDebtId" (selectionChange)="getTotalInDebtsByStatus()">
                                <mat-option value=""></mat-option>
                                <mat-option *ngFor="let statusInDebt of statusInDebts" [value]="statusInDebt.id">
                                    {{statusInDebt.status}}
                                </mat-option>
                            </mat-select>

                            <mat-select *ngIf="getOutDebt" name="statusOutDebtId" [(ngModel)]="statusOutDebtId" (selectionChange)="getTotalOutDebtsByStatus()">
                                <mat-option value=""></mat-option>
                                <mat-option *ngFor="let statusOutDebt of statusOutDebts" [value]="statusOutDebt.id">
                                    {{statusOutDebt.status}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </mat-grid-tile>
                    <mat-grid-tile><span style="font-size: 20px;">وقت الدفع</span></mat-grid-tile>

                    <mat-grid-tile>
                        <mat-form-field>
                            <mat-select *ngIf="getInDebt" name="creditorName" [(ngModel)]="creditorName" (selectionChange)="getTotalInDebtsByCreditor()">
                                <mat-option value=""></mat-option>
                                <mat-option *ngFor="let creditor of creditors" [value]="creditor">
                                    {{creditor}}
                                </mat-option>
                            </mat-select>

                            <mat-select *ngIf="getOutDebt" name="debtorName" [(ngModel)]="debtorName" (selectionChange)="getTotalOutDebtsByDebtor()">
                                <mat-option value=""></mat-option>
                                <mat-option *ngFor="let debtor of debtors" [value]="debtor">
                                    {{debtor}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </mat-grid-tile>
                    <mat-grid-tile>
                        <span *ngIf="getInDebt" style="font-size: 20px;">الدائنين</span>
                        <span *ngIf="getOutDebt" style="font-size: 20px;">المدينين</span>
                    </mat-grid-tile>

                    <mat-grid-tile *ngIf="statusInDebtId || statusOutDebtId || creditorName || debtorName">
                        <span *ngIf="statusInDebtId || creditorName" style="font-size: 20px;">
                            <span *ngIf="totalInDebtsByCreditor">{{ totalInDebtsByCreditor }}</span>
                            <span *ngIf="!totalInDebtsByCreditor">0DT</span>
                        </span>                  
                        <span *ngIf="statusOutDebtId || debtorName" style="font-size: 20px;">
                            <span *ngIf="totalOutDebtsByDebtor">{{ totalOutDebtsByDebtor }}</span>
                            <span *ngIf="!totalOutDebtsByDebtor">0DT</span>
                        </span>     
                    </mat-grid-tile>
                    <mat-grid-tile *ngIf="statusInDebtId || statusOutDebtId || creditorName || debtorName">
                        <span style="font-size: 20px;">الدين</span>
                    </mat-grid-tile>
                  </mat-grid-list>
            </mat-card>
        </div>
        <div class="col-md-3"></div>
    </div>
</div>

<div *ngIf="placeId == 6">
    <mat-grid-list cols="6" rowHeight="5:1" style="font-size: 20px;">
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile style="color: #dc3545;">{{ restInPosteAccount }}</mat-grid-tile>
        <mat-grid-tile>: الحساب البريدي</mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
    </mat-grid-list>
</div>

<br>

<div class="mat-elevation-z8">
    <table mat-table [dataSource]="dataSource">

        <ng-container matColumnDef="debtor">
            <th mat-header-cell *matHeaderCellDef>Debtor</th>
            <td mat-cell *matCellDef="let element" style="text-align: center;">
                <span *ngIf="element.debtor">{{ element.debtor }}</span>
                <span *ngIf="!element.debtor">-</span>
            </td>
        </ng-container>

        <ng-container matColumnDef="creditor">
            <th mat-header-cell *matHeaderCellDef>Creditor</th>
            <td mat-cell *matCellDef="let element" style="text-align: center;">
                <span *ngIf="element.creditor">{{ element.creditor }}</span>
                <span *ngIf="!element.creditor">-</span>
            </td>
        </ng-container>

        <ng-container matColumnDef="debt">
            <th mat-header-cell *matHeaderCellDef>Debt</th>
            <td mat-cell *matCellDef="let element" style="text-align: center;">
                <span *ngIf="element.financialDebt">{{ element.financialDebt }}</span>
                <span *ngIf="!element.financialDebt">-</span>
            </td>
        </ng-container>

        <ng-container matColumnDef="rest">
            <th mat-header-cell *matHeaderCellDef>Rest</th>
            <td mat-cell *matCellDef="let element" style="text-align: center;">
                <span *ngIf="element.restMoney">{{ element.restMoney }}</span>
                <span *ngIf="!element.restMoney">-</span>
            </td>
        </ng-container>

        <ng-container matColumnDef="details">
            <th mat-header-cell *matHeaderCellDef>Details</th>
            <td mat-cell *matCellDef="let element">
                <div style="margin-top: 50px;margin-bottom: 50px;">
                    <div class="gridForLegend">
                        <div><span>Date:</span></div>
                        <div>{{ element.date | date:'dd/MM/yyyy' }}</div>
                    </div>
                    <br>
                    <div class="gridForLegend">
                        <div><span>Place:</span></div>
                        <div>{{ element.place }}</div>
                    </div>
                    <br>
                    <div class="gridForLegend">
                        <div><span>Status:</span></div>
                        <div>
                            <span *ngIf="element.placeId === 5">
                                <span *ngIf="element.toPayThisMonth">Pay this month</span>
                                <span *ngIf="element.toPayNextMonth">Pay next month</span>
                                <span *ngIf="element.notToPayForNow">Pay will be delayed</span>
                                <span *ngIf="element.toGetThisMonth">Get this month</span>
                                <span *ngIf="element.toGetNextMonth">Get next month</span>
                                <span *ngIf="element.notToGetForNow">Get will be delayed</span>
                            </span>
                            <span *ngIf="element.placeId !== 5">-</span>
                        </div>
                    </div>
                    <br>
                    <div class="gridForLegend">
                        <div><span>Note:</span></div>
                        <div>{{ element.note }}</div>
                    </div> 
                </div>
                
            </td>
        </ng-container>

        <ng-container matColumnDef="actions">
            <mat-header-cell *matHeaderCellDef class="btns-add-sort">
                <button 
                    *ngIf="dataUserConnected.roleAddDebt" 
                    type="button" 
                    mat-icon-button 
                    color="primary" 
                    (click)="newDebt()">
                    <mat-icon aria-label="Example icon-button with a heart icon">add</mat-icon>
                </button>

                <button type="button" *ngIf="(dataSource.data.length) && (dataSource.data.length > 1) && !sortByDesc" mat-icon-button color="primary" (click)="sortByRefDebtDesc()">
                    <mat-icon aria-label="Example icon-button with a heart icon">sort</mat-icon>
                </button>

                <button type="button" *ngIf="(dataSource.data.length) && (dataSource.data.length > 1) && sortByDesc" mat-icon-button color="primary" (click)="sortByRefDebtAsc()">
                    <mat-icon aria-label="Example icon-button with a heart icon">sort</mat-icon>
                </button>
            </mat-header-cell>
    
            <mat-cell *matCellDef="let row; let i=index;" class="btns-edit-delete">  

                <button 
                    *ngIf="dataUserConnected.roleUpdateDebt"  
                    type="button" 
                    mat-icon-button 
                    color="primary" 
                    (click)="editDebt(row)">
                    <mat-icon aria-label="Edit">edit</mat-icon>
                </button>
        
                <button 
                    *ngIf="dataUserConnected.roleDeleteDebt" 
                    type="button" 
                    mat-icon-button 
                    color="warn" 
                    (click)="deleteDebt(row.key)">
                    <mat-icon aria-label="Delete">delete</mat-icon>
                </button>
                
            </mat-cell>
        </ng-container>
    
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row style="border-bottom: 1px solid black;"  *matRowDef="let row; columns: displayedColumns;"></tr>

    </table>

    <div class="no-results" [style.display]="dataSource.data.length == 0 ? '' : 'none'">
        No results
    </div>
    
    <mat-paginator 
        [pageSizeOptions]="[8]"
        showFirstLastButtons 
        aria-label="Select page of periodic elements">
    </mat-paginator>
</div>


<ng-template #contentRestMoneyForeachPlace let-modal let-c="close" let-d="dismiss">

    <h3 mat-dialog-title style="color: #dc3545;">Rest Money</h3>

    <mat-grid-list cols="2" rowHeight="4:1" style="font-size: 20px;">
        <mat-grid-tile>{{ restInPocket }}</mat-grid-tile>
        <mat-grid-tile>: الجيب</mat-grid-tile>
    </mat-grid-list>
    
    <br>
    <mat-divider></mat-divider>
    <br>
    
    <mat-grid-list cols="2" rowHeight="4:1" style="font-size: 20px;">
        <mat-grid-tile>{{ restInWallet }}</mat-grid-tile>
        <mat-grid-tile>: المحفظة</mat-grid-tile>
    </mat-grid-list>

    <br>
    <mat-divider></mat-divider>
    <br>
    
    <mat-grid-list cols="2" rowHeight="4:1" style="font-size: 20px;">
        <mat-grid-tile>{{ restInEnvelope }}</mat-grid-tile>
        <mat-grid-tile>: الظرف</mat-grid-tile>
    </mat-grid-list>

    <br>
    <mat-divider></mat-divider>
    <br>
    
    <mat-grid-list cols="2" rowHeight="4:1" style="font-size: 20px;">
        <mat-grid-tile>{{ restInBox }}</mat-grid-tile>
        <mat-grid-tile>: الصندوق</mat-grid-tile>
    </mat-grid-list>

    <br>
    <mat-divider></mat-divider>
    <br>
    
    <mat-grid-list cols="2" rowHeight="4:1" style="font-size: 20px;">
        <mat-grid-tile>{{ restInPosteAccount }}</mat-grid-tile>
        <mat-grid-tile>: الحساب البريدي</mat-grid-tile>
    </mat-grid-list>

</ng-template>



<ng-template #contentLoading let-modal let-c="close" let-d="dismiss">

    <div class="modal-header text-center">
      <h4 *ngIf="FileName" class="modal-title w-100 font-weight-bold text-application">test</h4>
  
      <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
          <span aria-hidden="true">&times;</span>
      </button>
    </div>
  
    <div class="modal-body text-application">
      <div *ngIf="isLoading">
        <mat-spinner></mat-spinner><br>
        <h3 style="text-align: center;">Delete debts in progress...</h3>
      </div>
    </div>
</ng-template>