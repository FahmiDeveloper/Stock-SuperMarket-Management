<h1 class="titleTextInterface text-application">Debts</h1>

<div class="row">
    <div class="col-md-4">
        <mat-form-field class="text-application" style="width: 250px;">
            <mat-label>Place</mat-label>
			<mat-select name="placeId" [(ngModel)]="placeId" (selectionChange)="isDesktop ? getAllDebtsForDesktop() : getAllDebtsForTablet()">
                <mat-option value=""></mat-option>
				<mat-option *ngFor="let placeMoney of placesMoney" [value]="placeMoney.id">
                    {{placeMoney.place}}
				</mat-option>
			</mat-select>
		</mat-form-field>
    </div>

    <div class="col-md-2"></div>

    <div class="col-md-2">
        <button 
            mat-flat-button 
            color="primary" 
            (click)="showRest(contentRestMoneyForeachPlace)" 
            class="text-application"
            style="position: absolute;top: 50%;transform: translateY(-50%);">
            Rest
        </button>
    </div>

    <div class="col-md-1">
        <button 
            *ngIf="(dataSource.data.length || debtsList) && (dataSource.data.length > 1 || debtsList.length > 1) && placeId" [hidden]="placeId == 5"
            mat-flat-button 
            color="warn" 
            (click)="deleteAllByPlace(contentLoading)"
            class="text-application"
            style="position: absolute;top: 50%;transform: translateY(-50%);">
            Delete all
        </button>
    </div>

    <div class="col-md-3">
        <button
            *ngIf="dataUserConnected.roleAddDebt"
            type="button" 
            (click)="newDebt()" 
            mat-mini-fab 
            color="primary" 
            style="background: #2196F3;float: right;top: 50%;transform: translateY(-50%);">
            <mat-icon style="color: white;">add</mat-icon>
        </button>

        <button 
            *ngIf="!sortByDesc"
            type="button"  
            mat-mini-fab 
            color="primary" 
            (click)="sortByRefDebtDesc()" 
            style="background: #2196F3;float: right;margin-right: 10px;top: 50%;transform: translateY(-50%);">
            <mat-icon style="color: white;" aria-label="Example icon-button with a heart icon">sort</mat-icon>
        </button>&nbsp;&nbsp;

        <button 
            *ngIf="sortByDesc"
            type="button"
            mat-mini-fab
            color="primary" 
            (click)="sortByRefDebtAsc()" 
            style="background: #2196F3;float: right;margin-right: 10px;top: 50%;transform: translateY(-50%);">
            <mat-icon style="color: white;" aria-label="Example icon-button with a heart icon">sort</mat-icon>
        </button>

    </div> 
</div>

<br>

<div *ngIf="placeId == 1">
    <mat-grid-list cols="6" rowHeight="5:1" style="font-size: 20px;">
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile class="text-application" style="color: #dc3545;">{{ restInPocket }}</mat-grid-tile>
        <mat-grid-tile>: الجيب</mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
    </mat-grid-list>
</div>

<div *ngIf="placeId == 2">
    <mat-grid-list cols="6" rowHeight="5:1" style="font-size: 20px;">
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile class="text-application" style="color: #dc3545;">{{ restInWallet }}</mat-grid-tile>
        <mat-grid-tile>: المحفظة</mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
    </mat-grid-list>
</div>

<div *ngIf="placeId == 3">
    <mat-grid-list cols="6" rowHeight="5:1" style="font-size: 20px;">
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile class="text-application" style="color: #dc3545;">{{ restInEnvelope }}</mat-grid-tile>
        <mat-grid-tile>: الظرف</mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
    </mat-grid-list>
</div>

<div *ngIf="placeId == 4">
    <mat-grid-list cols="6" rowHeight="5:1" style="font-size: 20px;">
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile class="text-application" style="color: #dc3545;">{{ restInBox }}</mat-grid-tile>
        <mat-grid-tile>: الصندوق</mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
    </mat-grid-list>
</div>

<div *ngIf="placeId == 5">
    <mat-grid-list cols="8" rowHeight="3:1" style="font-size: 20px;">
        
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile>الدين المسال</mat-grid-tile>
        <mat-grid-tile>
            <mat-checkbox 
                name="getOutDebt" 
                [(ngModel)]="getOutDebt" 
                (ngModelChange)="showOutDebt()">
            </mat-checkbox>
        </mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile>الدين المتخلد</mat-grid-tile>
        <mat-grid-tile>
            <mat-checkbox 
                name="getInDebt" 
                [(ngModel)]="getInDebt"         
                (ngModelChange)="showInDebt()">
            </mat-checkbox>
        </mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        
    </mat-grid-list>

    <br>

    <div class="row text-application" *ngIf="getInDebt || getOutDebt">
        <div class="col-md-3"></div>
        <div class="col-md-6">
            <mat-card class="text-application">
                <mat-grid-list cols="2" rowHeight="3:1">
                    <mat-grid-tile>
                        <span style="font-size: 20px;">
                            <span *ngIf="getInDebt">
                                <span *ngIf="totalInDebts">{{ totalInDebts }}</span>
                                <span *ngIf="!totalInDebts">0DT</span>
                            </span>
                            <span *ngIf="getOutDebt">
                                <span *ngIf="totalOutDebts">{{ totalOutDebts }}</span>
                                <span *ngIf="!totalOutDebts">0DT</span>
                            </span>  
                        </span>    
                    </mat-grid-tile>
                    <mat-grid-tile><span style="font-size: 20px;">المجموع</span></mat-grid-tile>

                    <mat-grid-tile>
                        <mat-form-field  [ngStyle]="{'width': isTablet ? '148px': ''}">
                            <mat-select *ngIf="getInDebt" name="statusInDebtId" [(ngModel)]="statusInDebtId" (selectionChange)="getTotalInDebtsByStatus()" class="text-application">
                                <mat-option value=""></mat-option>
                                <mat-option *ngFor="let statusInDebt of statusInDebts" [value]="statusInDebt.id">
                                    <span class="text-application">{{statusInDebt.status}}</span>
                                </mat-option>
                            </mat-select>

                            <mat-select *ngIf="getOutDebt" name="statusOutDebtId" [(ngModel)]="statusOutDebtId" (selectionChange)="getTotalOutDebtsByStatus()" class="text-application">
                                <mat-option value=""></mat-option>
                                <mat-option *ngFor="let statusOutDebt of statusOutDebts" [value]="statusOutDebt.id">
                                    <span class="text-application">{{statusOutDebt.status}}</span>
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </mat-grid-tile>
                    <mat-grid-tile><span style="font-size: 20px;">وقت الدفع</span></mat-grid-tile>

                    <mat-grid-tile>
                        <mat-form-field  [ngStyle]="{'width': isTablet ? '148px': ''}">
                            <mat-select *ngIf="getInDebt" name="creditorName" [(ngModel)]="creditorName" (selectionChange)="getTotalInDebtsByCreditor()" class="text-application">
                                <mat-option value=""></mat-option>
                                <mat-option *ngFor="let creditor of creditors" [value]="creditor">
                                    <span class="text-application">{{creditor}}</span>
                                </mat-option>
                            </mat-select>

                            <mat-select *ngIf="getOutDebt" name="debtorName" [(ngModel)]="debtorName" (selectionChange)="getTotalOutDebtsByDebtor()" class="text-application">
                                <mat-option value=""></mat-option>
                                <mat-option *ngFor="let debtor of debtors" [value]="debtor">
                                    <span class="text-application">{{debtor}}</span>
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </mat-grid-tile>
                    <mat-grid-tile>
                        <span *ngIf="getInDebt" style="font-size: 20px;">الدائنين</span>
                        <span *ngIf="getOutDebt" style="font-size: 20px;">المدينين</span>
                    </mat-grid-tile>

                    <mat-grid-tile *ngIf="statusInDebtId || statusOutDebtId || creditorName || debtorName">
                        <span *ngIf="statusInDebtId || creditorName" style="font-size: 20px;">
                            <span *ngIf="totalInDebtsByCreditor">{{ totalInDebtsByCreditor }}</span>
                            <span *ngIf="!totalInDebtsByCreditor">0DT</span>
                        </span>                  
                        <span *ngIf="statusOutDebtId || debtorName" style="font-size: 20px;">
                            <span *ngIf="totalOutDebtsByDebtor">{{ totalOutDebtsByDebtor }}</span>
                            <span *ngIf="!totalOutDebtsByDebtor">0DT</span>
                        </span>     
                    </mat-grid-tile>
                    <mat-grid-tile *ngIf="statusInDebtId || statusOutDebtId || creditorName || debtorName">
                        <span style="font-size: 20px;">الدين</span>
                    </mat-grid-tile>
                  </mat-grid-list>
            </mat-card>
        </div>
        <div class="col-md-3"></div>
    </div>
</div>

<div *ngIf="placeId == 6">
    <mat-grid-list cols="6" rowHeight="5:1" style="font-size: 20px;">
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile class="text-application" style="color: #dc3545;">{{ restInPosteAccount }}</mat-grid-tile>
        <mat-grid-tile>: الحساب البريدي</mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
        <mat-grid-tile></mat-grid-tile>
    </mat-grid-list>
</div>

<br>

<div [ngClass]="isDesktop ? 'mat-elevation-z8' : 'row'">

    <ng-container *ngIf="isDesktop">
        <table mat-table [dataSource]="dataSource">
    
            <ng-container matColumnDef="debtor">
                <th mat-header-cell *matHeaderCellDef class="text-application" style="color: white;">Debtor</th>
                <td mat-cell *matCellDef="let element" class="text-application" style="text-align: center;">
                    <span *ngIf="element.debtor">{{ element.debtor }}</span>
                    <span *ngIf="!element.debtor">-</span>
                </td>
            </ng-container>
    
            <ng-container matColumnDef="creditor">
                <th mat-header-cell *matHeaderCellDef class="text-application" style="color: white;">Creditor</th>
                <td mat-cell *matCellDef="let element" class="text-application" style="text-align: center;">
                    <span *ngIf="element.creditor">{{ element.creditor }}</span>
                    <span *ngIf="!element.creditor">-</span>
                </td>
            </ng-container>
    
            <ng-container matColumnDef="debt">
                <th mat-header-cell *matHeaderCellDef class="text-application" style="color: white;">Debt</th>
                <td mat-cell *matCellDef="let element" class="text-application" style="text-align: center;">
                    <span *ngIf="element.financialDebt">{{ element.financialDebt }}</span>
                    <span *ngIf="!element.financialDebt">-</span>
                </td>
            </ng-container>
    
            <ng-container matColumnDef="rest">
                <th mat-header-cell *matHeaderCellDef class="text-application" style="color: white;">Rest</th>
                <td mat-cell *matCellDef="let element" class="text-application" style="text-align: center;">
                    <span *ngIf="element.restMoney">{{ element.restMoney }}</span>
                    <span *ngIf="!element.restMoney">-</span>
                </td>
            </ng-container>
    
            <ng-container matColumnDef="details">
                <th mat-header-cell *matHeaderCellDef class="text-application" style="color: white;">Details</th>
                <td mat-cell *matCellDef="let element">
                    <div style="margin-top: 50px;margin-bottom: 50px;">
                        <div class="gridForLegend text-application">
                            <div><span>Date:</span></div>
                            <div>{{ element.date | date:'dd/MM/yyyy' }}</div>
                        </div>
                        <br>
                        <div class="gridForLegend text-application">
                            <div><span>Place:</span></div>
                            <div>{{ element.place }}</div>
                        </div>
                        <br>
                        <div class="gridForLegend text-application">
                            <div><span>Status:</span></div>
                            <div>
                                <span *ngIf="element.placeId === 5">
                                    <span *ngIf="element.toPayThisMonth">Pay this month</span>
                                    <span *ngIf="element.toPayNextMonth">Pay next month</span>
                                    <span *ngIf="element.notToPayForNow">Pay will be delayed</span>
                                    <span *ngIf="element.toGetThisMonth">Get this month</span>
                                    <span *ngIf="element.toGetNextMonth">Get next month</span>
                                    <span *ngIf="element.notToGetForNow">Get will be delayed</span>
                                </span>
                                <span *ngIf="element.placeId !== 5">-</span>
                            </div>
                        </div>
                        <br>
                        <div class="gridForLegend text-application">
                            <div><span>Note:</span></div>
                            <div>{{ element.note }}</div>
                        </div> 
                    </div>
                    
                </td>
            </ng-container>
    
            <ng-container matColumnDef="star">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let element"> 
                    <button mat-icon-button [matMenuTriggerFor]="contextMenu" [matMenuTriggerData]="{element:element}">
                        <mat-icon>more_vert</mat-icon>
                    </button>
                </td>
            </ng-container>
        
            <tr mat-header-row style="background: #ff4081;" *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row style="border-bottom: 1px solid black;"  *matRowDef="let row; columns: displayedColumns;"></tr>
    
        </table>
    </ng-container>

    <ng-container *ngIf="isTablet">
        <div *ngFor="let debt of pagedList" class="mx-auto my-3 col-md-4">
            <mat-card class="text-application example-card-tablet">
                <mat-card-content>
                    <mat-grid-list cols="12">
                        <mat-grid-tile colspan="4">Debtor</mat-grid-tile>             
                        <mat-grid-tile colspan="8">
                            <span *ngIf="debt.debtor">{{ debt.debtor }}</span>
                            <i *ngIf="!debt.debtor" class="fa fa-minus-circle" aria-hidden="true"></i>
                        </mat-grid-tile><br>

                        <mat-grid-tile colspan="4">Creditor</mat-grid-tile>                
                        <mat-grid-tile colspan="8">
                            <span *ngIf="debt.creditor">{{ debt.creditor }}</span>
                            <i *ngIf="!debt.creditor" class="fa fa-minus-circle" aria-hidden="true"></i>
                        </mat-grid-tile><br>

                        <mat-grid-tile colspan="4">Debt</mat-grid-tile>                
                        <mat-grid-tile colspan="8">
                            <span *ngIf="debt.financialDebt">{{ debt.financialDebt }}</span>
                            <i *ngIf="!debt.financialDebt" class="fa fa-minus-circle" aria-hidden="true"></i>
                        </mat-grid-tile><br>

                        <mat-grid-tile colspan="4">Rest</mat-grid-tile>               
                        <mat-grid-tile colspan="8">
                            <span *ngIf="debt.restMoney">{{ debt.restMoney }}</span>
                            <i *ngIf="!debt.restMoney" class="fa fa-minus-circle" aria-hidden="true"></i>
                        </mat-grid-tile><br>

                        <mat-grid-tile colspan="4">Date</mat-grid-tile>
                        <mat-grid-tile colspan="8">{{ debt.date | date:'dd/MM/yyyy' }}</mat-grid-tile><br>

                        <mat-grid-tile colspan="4">Place</mat-grid-tile>
                        <mat-grid-tile colspan="8">{{ debt.place }}</mat-grid-tile><br>

                        <mat-grid-tile colspan="4">Status</mat-grid-tile>
                        <mat-grid-tile colspan="8">
                            <span *ngIf="debt.placeId === 5">
                                <span *ngIf="debt.toPayThisMonth">Pay this month</span>
                                <span *ngIf="debt.toPayNextMonth">Pay next month</span>
                                <span *ngIf="debt.notToPayForNow">Pay will be delayed</span>
                                <span *ngIf="debt.toGetThisMonth">Get this month</span>
                                <span *ngIf="debt.toGetNextMonth">Get next month</span>
                                <span *ngIf="debt.notToGetForNow">Get will be delayed</span>
                            </span>
                            <span *ngIf="debt.placeId !== 5">-</span>
                        </mat-grid-tile><br>

                        <mat-grid-tile colspan="4">Note</mat-grid-tile>                
                        <mat-grid-tile colspan="8">
                            <mat-icon *ngIf="debt.note" style="color: black;" (click)="viewNote(debt.note)">note</mat-icon>         
                            <i *ngIf="!debt.note" class="fa fa-minus-circle" aria-hidden="true"></i>
                        </mat-grid-tile>

                    </mat-grid-list>
                </mat-card-content>
                <mat-card-actions>
                    <div class="row justify-content-center">
                        <button 
                            type="button"
                            mat-button
                            [matMenuTriggerFor]="menu" 
                            class="style-button text-application">
                            <mat-icon style="color: #07609b">calendar_view_day</mat-icon>
                            Actions
                        </button>
                        <mat-menu #menu="matMenu" class="my-menu" xPosition="before">
                            <button
                                mat-menu-item 
                                class="text-application"
                                (click)="editDebt(debt)">
                                <mat-icon style="color: #9C27B0">edit</mat-icon>
                                Edit
                            </button>
                            <button
                                mat-menu-item 
                                class="text-application"
                                (click)="deleteDebt(debt.key)">
                                <mat-icon style="color: #f44336">delete</mat-icon>
                                Delete
                            </button>
                        </mat-menu>
                    </div>
                </mat-card-actions>          
            </mat-card>
        </div>
    </ng-container>

    <div *ngIf="isDesktop && dataSource.data.length == 0" class="row justify-content-center no-results text-application">
        No results
    </div>

    <mat-paginator
        *ngIf="isDesktop"
        [pageSize]="8"
        [pageSizeOptions]="[8]"
        showFirstLastButtons
        (page)="OnPageChangeForDesktop($event)">
    </mat-paginator>

</div>

<div *ngIf="isTablet && pagedList.length == 0" class="row justify-content-center no-results text-application">
    No results
</div>

<div class="row mat-paginator" *ngIf="isTablet">
    <mat-paginator 
        [length]="length"
        [pageSize]="6"
        [pageSizeOptions]="[6]"
        showFirstLastButtons
        (page)="OnPageChangeForTablet($event)">
    </mat-paginator>
</div>

<mat-menu #contextMenu="matMenu" xPosition="before">
	<ng-template matMenuContent let-debt="element">

        <button 
            *ngIf="dataUserConnected.roleUpdateDebt"  
            type="button" 
            mat-menu-item 
            (click)="editDebt(debt)">
            <mat-icon style="color: #9C27B0" aria-label="Edit">edit</mat-icon>
            <span>Edit</span>
        </button>

        <button
            *ngIf="dataUserConnected.roleDeleteDebt" 
            type="button"
            mat-menu-item 
            (click)="deleteDebt(debt.key)" 
            class="text-application">
            <mat-icon style="color: #f44336;">delete</mat-icon>
            <span>Delete</span>
        </button>

	</ng-template>
</mat-menu>

<ng-template #contentRestMoneyForeachPlace>

    <div mat-dialog-title class="dialog-title">
        <h2 class="text-application">Rest Money</h2>
        <button mat-icon-button aria-label="close dialog" mat-dialog-close>
          <mat-icon>close</mat-icon>
        </button>
    </div>

    <mat-grid-list cols="2" rowHeight="4:1" class="text-application" style="font-size: 20px;">
        <mat-grid-tile>{{ restInPocket }}</mat-grid-tile>
        <mat-grid-tile>: الجيب</mat-grid-tile>
    </mat-grid-list>
    
    <br>
    <mat-divider></mat-divider>
    <br>
    
    <mat-grid-list cols="2" rowHeight="4:1" class="text-application" style="font-size: 20px;">
        <mat-grid-tile>{{ restInWallet }}</mat-grid-tile>
        <mat-grid-tile>: المحفظة</mat-grid-tile>
    </mat-grid-list>

    <br>
    <mat-divider></mat-divider>
    <br>
    
    <mat-grid-list cols="2" rowHeight="4:1" class="text-application" style="font-size: 20px;">
        <mat-grid-tile>{{ restInEnvelope }}</mat-grid-tile>
        <mat-grid-tile>: الظرف</mat-grid-tile>
    </mat-grid-list>

    <br>
    <mat-divider></mat-divider>
    <br>
    
    <mat-grid-list cols="2" rowHeight="4:1" class="text-application" style="font-size: 20px;">
        <mat-grid-tile>{{ restInBox }}</mat-grid-tile>
        <mat-grid-tile>: الصندوق</mat-grid-tile>
    </mat-grid-list>

    <br>
    <mat-divider></mat-divider>
    <br>
    
    <mat-grid-list cols="2" rowHeight="4:1" class="text-application" style="font-size: 20px;">
        <mat-grid-tile>{{ restInPosteAccount }}</mat-grid-tile>
        <mat-grid-tile>: الحساب البريدي</mat-grid-tile>
    </mat-grid-list>

</ng-template>

<ng-template #contentLoading>

    <div mat-dialog-title class="dialog-title">
        <h2 class="text-application">Delete debts</h2>
        <button mat-icon-button aria-label="close dialog" mat-dialog-close>
          <mat-icon>close</mat-icon>
        </button>
    </div>
  
    <div class="modal-body text-application">
      <div *ngIf="isLoading">
        <mat-spinner style="margin-left:100px; margin-top: 30px;"></mat-spinner><br>
        <h3 class="text-application" style="text-align: center;">Delete debts in progress...</h3>
      </div>
    </div>

</ng-template>