<h1 class="titleTextInterface text-application">Movies</h1>

<div class="row">
    <div class="col-md-3">
        <mat-form-field class="widthInput">
            <mat-label class="text-application">Name</mat-label>
            <input matInput type="text" name="movieName" (keyup)="getAllMovies()" [(ngModel)]="movieName"/>
        </mat-form-field>
    </div>
    <div class="col-md-3">
        <mat-form-field class="widthInput">
            <mat-label class="text-application">Status</mat-label>
            <mat-select name="statusId" [(ngModel)]="statusId" (selectionChange)="getAllMovies()">
                <mat-option value=""></mat-option>
                <mat-option *ngFor="let statusMovie of statusMovies" [value]="statusMovie.id">
                    <span class="text-application">{{statusMovie.status}}</span>
                </mat-option>
            </mat-select>
        </mat-form-field>
    </div>
    <div class="col-md-2">
        <ng-container *ngIf="statusId">
            <mat-form-field class="widthInput" *ngIf="statusId == 1">
                <mat-select [(ngModel)]="optionSelected" name="optionSelected" class="text-application" (selectionChange)="getAllMovies()">
                    <mat-option value=""></mat-option>
                    <mat-option [value]="1" class="text-application">Not yet aired</mat-option>
                    <mat-option [value]="2" class="text-application">{{nbrMoviesToCheckToday}}&nbsp;movie(s) to check Today</mat-option>
                </mat-select>
            </mat-form-field>
    
            <mat-checkbox *ngIf="statusId == 3" name="dislike" [(ngModel)]="dislike" (ngModelChange)="getAllMovies()" class="mat-checkbox-layout" style="margin-top: 10%;">
                <span class="text-application">Dislike</span>
            </mat-checkbox>
        </ng-container> 
    </div>
    <div class="col-md-2"></div>
    <div class="col-md-2">
        <button 
            type="button" 
            (click)="newMovie()" 
            mat-mini-fab 
            style="background: #2196F3;float: right;">
            <mat-icon style="color: white;">add</mat-icon>
        </button>
    </div>     
</div>

<br>

<div class="row mt-4">
    <div class="col-12">
     
        <div class="card" *ngFor="let movie of (moviesList | paginate: { itemsPerPage: 6, currentPage: p })" style="margin-bottom: 20px !important;">
            <div class="card-body">
                <div class="row">

                    <div [ngClass]="isTablet ? 'col-md-3' : 'col-md-2'">
                        <img *ngIf="movie.imageUrl" [src]="movie.imageUrl" class="movie-image">
                        <img *ngIf="!movie.imageUrl" src="/assets/pictures/NoImageAvailable.png" class="movie-image">
                    </div>

                    <div [ngClass]="isTablet ? 'col-md-3' : 'col-md-4'" class="dotted-border center-name-movie">
                        <h1 class="text-application" [ngStyle]="{'cursor': isDesktop ? 'pointer': ''}" (click)="copyText(movie.nameMovie)">{{ movie.nameMovie }}</h1>
                    </div>

                    <div class="col-md-4 dotted-border text-application">
                        <div class="gridForLegend">
                            <div><dt>Year</dt></div>
                            <div>
                                <span *ngIf="movie.year">{{ movie.year }}</span>
                                <span *ngIf="!movie.year">?</span>
                            </div>
                        </div>

                        <br>

                        <div class="gridForLegend">
                            <div><dt>Status</dt></div>
                            <div>
                                <i *ngIf="movie.statusId == 1" class="fa fa-spinner fa-spin" style="color:goldenrod;"></i>
                                <i *ngIf="movie.statusId == 2" class="fa fa-download" style="color: red;"></i>
                                <i *ngIf="movie.statusId == 3" class="fa fa-eye" style="color: green;"></i>
                                <i *ngIf="movie.statusId == 4" class="fa fa-eye" style="color: red;"></i>
                                <i *ngIf="movie.statusId == 5" class="fa fa-search" style="color:#07609b;"></i>
                                &nbsp;
                                <i *ngIf="movie.notLiked" class="fa fa-thumbs-down" style="color: red;"></i>
                            </div>
                        </div>

                        <br>

                        <div *ngIf="movie.statusId == 1" class="gridForLegend">
                            <div><dt>Check</dt></div>
                            <div>
                                <span *ngIf="movie.checkDate">{{ movie.checkDate | date: 'dd/MM/yyyy' }}</span>
                                <span *ngIf="!movie.checkDate">?</span>
                            </div>
                        </div>

                        <br *ngIf="movie.statusId == 1">

                        <div *ngIf="movie.part" class="gridForLegend">
                            <div><dt>Part</dt></div>
                            <div>{{ movie.part }}</div>
                        </div>

                        <br *ngIf="movie.part">

                        <div class="gridForLegend">
                            <div><dt>Note</dt></div>
                            <div>
                                <mat-icon *ngIf="movie.note" style="color: black;" [ngStyle]="{'cursor': isDesktop ? 'pointer': ''}" (click)="viewNote(movie.note)">note</mat-icon>         
                                <i *ngIf="!movie.note" class="fa fa-minus-circle"></i>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-2 dotted-border">
                        <button
                            *ngIf="movie.part && movie.part == 1" 
                            type="button"
                            mat-button 
                            (click)="showDetailsMovie(movie)"
                            class="style-button text-application center-btn">
                            <mat-icon style="color: #a54403">view_list</mat-icon>
                            <span>Parts</span>
                        </button>           
                        <button 
                            *ngIf="!movie.part || (movie.part && movie.part > 1)"
                            type="button"
                            mat-button
                            [matMenuTriggerFor]="menu" 
                            class="style-button text-application center-btn">
                            <mat-icon style="color: #07609b">calendar_view_day</mat-icon>
                            Actions
                        </button>
                        <mat-menu #menu="matMenu" class="my-menu" xPosition="before">
                            <button
                                mat-menu-item 
                                class="text-application"
                                (click)="editMovie(movie)">
                                <mat-icon style="color: #9C27B0">edit</mat-icon>
                                Edit
                            </button>
                            <button
                                *ngIf="movie.statusId == 1 && movie.path" 
                                mat-menu-item 
                                class="text-application"
                                (click)="followLink(movie.path)">
                                <mat-icon style="color: #3f51b5">remove_red_eye</mat-icon>
                                Check
                            </button>
                            <button
                                *ngIf="movie.statusId == 2 && movie.path" 
                                mat-menu-item 
                                class="text-application"
                                (click)="followLink(movie.path)">
                                <mat-icon style="color: green">cloud_download</mat-icon>
                                Download
                            </button>
                            <button
                                *ngIf="movie.statusId == 4 && movie.path"  
                                mat-menu-item 
                                class="text-application"
                                (click)="followLink(movie.path)">
                                <mat-icon style="color: #3f51b5">remove_red_eye</mat-icon>
                                Watch
                            </button>
                            <button
                                *ngIf="movie.statusId == 5 && movie.path" 
                                mat-menu-item 
                                class="text-application"
                                (click)="followLink(movie.path)">
                                <mat-icon style="color: #0e8999">search</mat-icon>
                                Search
                            </button>
                            <button
                                mat-menu-item 
                                class="text-application"
                                (click)="deleteMovie(movie.key)">
                                <mat-icon style="color: #f44336;">delete</mat-icon>
                                Delete
                            </button>
                        </mat-menu>
                    </div>
                    
                </div>        
            </div>
        </div>
    </div>
</div>

<br>

<div *ngIf="moviesList.length !== 0" class="pagination">
    <pagination-controls (pageChange)="p = $event;OnPageChange($event)"></pagination-controls>
</div>

<div *ngIf="moviesList.length == 0" class="row justify-content-center no-results text-application">
    No results
</div>