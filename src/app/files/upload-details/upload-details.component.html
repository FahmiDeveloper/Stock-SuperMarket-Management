<div class="mat-elevation-z8">
  <table mat-table [dataSource]="dataSource">

      <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Name</th>
          <td mat-cell *matCellDef="let element" style="text-align: center;">{{ element.fileNameWithoutType }}</td>
      </ng-container>

      <ng-container matColumnDef="actions">
          <mat-header-cell *matHeaderCellDef></mat-header-cell>

          <mat-cell *matCellDef="let row; let i=index;" class="btns-view-download-delete">  

            <button
              *ngIf="!checkIsImage(row.name) && !isZip(row.name)"
              type="button"
              color="primary"
              mat-icon-button 
              (click)="viewOtherFileUpload(row, showOtherFile)">
              <mat-icon>remove_red_eye</mat-icon>
            </button>

            <button
              *ngIf="checkIsImage(row.name)"
              type="button"
              color="primary"
              mat-icon-button 
              (click)="viewFilePictureUpload(row, showPicture)">
              <mat-icon>remove_red_eye</mat-icon>
            </button>

            <button
              *ngIf="isZip(row.name)"
              type="button"
              color="primary"
              mat-icon-button 
              (click)="showZipFile(row, viewZipFile)">
              <mat-icon>remove_red_eye</mat-icon>
            </button>

            <button
              type="button"
              color="accent"
              mat-icon-button 
              (click)="downloadFile(row)">
              <mat-icon>cloud_download</mat-icon>
            </button>

            <button
              *ngIf="userRoles.roleDeleteFile"
              type="button"
              color="warn"
              mat-icon-button 
              (click)="deleteFileUpload(row)">
              <mat-icon aria-label="Delete">delete</mat-icon>
            </button>
  
            <button
              *ngIf="isMobile && (checkIsImage(row.name) || isTxt(row.name)  || isPdf(row.name))"
              type="button"
              color="accent"
              mat-icon-button 
              (click)="shareFile(row)">
              <mat-icon>share</mat-icon>              
            </button>  
              
          </mat-cell>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row style="border-bottom: 1px solid black;"  *matRowDef="let row; columns: displayedColumns;"></tr>

    </table>
  
    <div class="no-results" [style.display]="dataSource.data.length == 0 ? '' : 'none'">
      No results
    </div>
  
    <mat-paginator 
      [pageSizeOptions]="[8]"
      showFirstLastButtons 
      aria-label="Select page of periodic elements">
    </mat-paginator>
</div>


<ng-template #showOtherFile let-modal let-c="close" let-d="dismiss">

  <div class="modal-header text-center">
      <h4 class="modal-title w-100 font-weight-bold">{{ FileName }}</h4>

      <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
          <span aria-hidden="true">&times;</span>
      </button>
  </div>

  <div class="modal-body">
      <div class="container">
          <div class="row">        
            <ngx-doc-viewer
              *ngIf="urlFile" 
              [url]="urlFile" 
              viewer="google" 
              [ngClass]="isMobile ? 'otherFileMobile' : 'otherFile'">
            </ngx-doc-viewer>
          </div>  
      </div>
  </div>        
</ng-template>


<ng-template #showPicture let-modal let-c="close" let-d="dismiss">

  <div class="modal-header text-center">
    <h4 class="modal-title w-100 font-weight-bold">{{ FileName }}</h4>

    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
        <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div class="modal-body">
      <img *ngIf="pictureFile" [src]='pictureFile' [ngClass]="isMobile ? 'pictureFileMobile' : 'pictureFile'">
  </div>
</ng-template>


<ng-template #viewZipFile let-modal let-c="close" let-d="dismiss">

  <div class="modal-header text-center">
    <h4 *ngIf="FileName" class="modal-title w-100 font-weight-bold text-application">{{ FileName }}</h4>

    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
        <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div class="modal-body text-application">
    <div *ngIf="isLoading" class="text-center">
      <div class="spinner-border" style="width: 10rem; height: 10rem;" role="status"></div><br><br>
      <h4>Extract files in progress...</h4>
    </div>
    
    <ul *ngIf="!isLoading">
        <ng-container *ngFor="let file of $zipFiles | async">
          <li *ngIf="file.fileName">
            <h5>
              {{file.fileName}}<br>
              <small style="font-weight: bold;color:blue;">({{file.date | date: 'dd/MM/yyyy'}})</small>&nbsp;
              <button
                type="button"
                (click)="viewFileFromZip(file, showContentFilesFromZip)"
                class="btn btn-primary">
                <i class="fa fa-eye" aria-hidden="true"></i>
              </button>&nbsp;
              <button
                type="button"
                (click)="saveFileFromZip(file)"
                class="btn btn-success">
                <i class="fa fa-download" aria-hidden="true"></i>
              </button>
            </h5> 
          </li><br *ngIf="file.fileName">
        </ng-container>
    </ul>
  </div>
</ng-template>

<ng-template #showContentFilesFromZip let-modal let-c="close" let-d="dismiss">

  <div class="modal-header text-center text-application">
      <h4 *ngIf="fileExtractedName" class="modal-title w-100 font-weight-bold">{{ fileExtractedName }}</h4>

      <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
          <span aria-hidden="true">&times;</span>
      </button>
  </div>

  <div class="modal-body">

    <img *ngIf="checkIsImage(fileExtractedName)" [src]='srcExtractedImage' [ngClass]="isMobile ? 'pictureFileMobile' : 'pictureFile'">

    <pre 
      *ngIf="isTxt(fileExtractedName)"
      style="font-weight: bold;">
      {{contentTxtFile}}
    </pre>

    <pdf-viewer
      *ngIf="isPdf(fileExtractedName)"
      [src]="contentPdfFile"      
      [rotation]="0"
      [original-size]="false"
      [show-all]="true"
      [fit-to-page]="false"
      [zoom]="1"
      [zoom-scale]="'page-width'"
      [stick-to-page]="false"
      [render-text]="true"
      [external-link-target]="'blank'"
      [autoresize]="true"
      [show-borders]="false"
      style="width: 100%; height: 600px;">
    </pdf-viewer>

    <div *ngIf="isExcel(fileExtractedName) && isMobile" class="scroll">
      <table *ngIf="isExcel(fileExtractedName)" id="TheTable" class="ExcelTable2007">
        <thead #header>
          <tr>
            <th style="background-color:#d9d9d9;"></th>
            <th *ngFor="let headValue of headData">
              {{headValue}}
            </th>
          </tr>
        </thead>
        <tbody #container>
          <tr *ngFor="let row of data; let e =index">
            <td style="background-color:#d9d9d9;">{{e+1}}</td>
            <td *ngFor="let val of headData; let i =index">
              {{row[i] || ' '}} 
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="isExcel(fileExtractedName) && !isMobile">
      <table *ngIf="isExcel(fileExtractedName)" id="TheTable" class="ExcelTable2007">
        <thead #header>
          <tr>
            <th style="background-color:#d9d9d9;"></th>
            <th *ngFor="let headValue of headData">
              {{headValue}}
            </th>
          </tr>
        </thead>
        <tbody #container>
          <tr *ngFor="let row of data; let e =index">
            <td style="background-color:#d9d9d9;">{{e+1}}</td>
            <td *ngFor="let val of headData; let i =index">
              {{row[i] || ' '}} 
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="isWord(fileExtractedName) && isMobile" id="contentWord" class="scroll"></div>

    <div *ngIf="isWord(fileExtractedName) && !isMobile" id="contentWord"></div>

  </div>        
</ng-template>