<h1 class="titleTextInterface text-application">Files</h1>

<mat-grid-list cols=2 #grid rowHeight="315px" gutterSize="15px">
  <mat-grid-tile *ngFor="let typeFile of typesFiles">
    <mat-card class="settings-card" style="cursor: pointer;border: 1px solid;">
      <mat-card-title class="text-application">{{ typeFile.title }}</mat-card-title>
      <img [src]="typeFile.icon" [ngClass]="isMobile ? 'imageTypeFileMobile' : 'imageTypeFile'" (click)="openListFiles(contentListFiles, contentLinks, typeFile)">
    </mat-card>
  </mat-grid-tile>
</mat-grid-list>

<ng-template #contentListFiles let-modal let-c="close" let-d="dismiss">

  <div mat-dialog-title class="dialog-title">
    <h2 class="text-application">{{ typeFile.type }} files</h2>
    <button mat-icon-button aria-label="close dialog" mat-dialog-close>
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <div class="row">
      <div class="col-md-12">
          <app-upload-form 
            [typeFileId]="typeFile.id" 
            [user]="dataUserConnected" 
            [defaultArrayFiles]="defaultArrayFiles" 
            (refContextFile)="getRefContextFile($event)">
          </app-upload-form>
      </div>
  </div><br>
  <div class="row">
      <div class="col-md-12">
          <app-upload-list 
            [isMobile]="isMobile" 
            [typeFileId]="typeFile.id" 
            [numContextFile]="numContextFile" 
            [user]="dataUserConnected" 
            (arrayFiles)="getDefaultArrayFiles($event)">
          </app-upload-list>
      </div>
  </div>

</ng-template>
  
<ng-template #contentLinks let-modal let-c="close" let-d="dismiss">

  <div mat-dialog-title class="dialog-title">
    <h2 *ngIf="!clickShowLinks" class="text-application">{{ typeFile.type }} files</h2>
    <h2 *ngIf="clickShowLinks" class="text-application">{{ typeFile.type }} links</h2>
    <button mat-icon-button aria-label="close dialog" mat-dialog-close>
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-grid-list cols="4" rowHeight="3:1" class="text-application" style="font-size: 20px;">
      
    <mat-grid-tile>Angular</mat-grid-tile>
    <mat-grid-tile>
        <mat-checkbox 
            name="angularContext" 
            [(ngModel)]="angularContext" 
            (ngModelChange)="checkAngularContext()"
            style="margin-top: 10px;">
        </mat-checkbox>
    </mat-grid-tile>
    <mat-grid-tile>Other</mat-grid-tile>
    <mat-grid-tile>
        <mat-checkbox 
            name="otherContext" 
            [(ngModel)]="otherContext"         
            (ngModelChange)="checkotherContext()"
            style="margin-top: 10px;">
        </mat-checkbox>
    </mat-grid-tile>
      
  </mat-grid-list>

  <br *ngIf="angularContext || otherContext">

  <button 
    *ngIf="dataUserConnected.roleAddFile && (angularContext || otherContext)"
    type="button"  
    (click)="newLink()" 
    mat-mini-fab 
    style="background: #2196F3 !important;margin-left: 445px;">
    <mat-icon style="color: white;">add</mat-icon>
  </button>

  <br *ngIf="angularContext || otherContext">

  <br>

  <div class="row">
    <div class="col-md-6" *ngIf="!isMobile">
      <mat-form-field class="widhtInput text-application">
        <mat-label>Content</mat-label>
        <input matInput (input)="getAllLinks()" type="text" [(ngModel)]="content"/>
      </mat-form-field>
    </div>
    <div class="col-md-4" *ngIf="isMobile">
      <mat-form-field class="widhtInput text-application">
        <mat-label>Content</mat-label>
        <input matInput (input)="getAllLinks()" type="text" [(ngModel)]="content"/>
      </mat-form-field>
    </div>
  </div>

  <br>

  <div class="row">   
    <div class="col-md-12">

      <div class="example-container mat-elevation-z8">
        <div class="example-table-container">
          <table mat-table [dataSource]="dataSource">
      
            <ng-container matColumnDef="content">
              <th mat-header-cell *matHeaderCellDef class="text-application" style="color: white;">Content</th>
              <td mat-cell *matCellDef="let element" class='m-card-title text-application' [ngStyle]="{'height': !isMobile ? '100px' : ''}">{{element.content}}</td>
            </ng-container>
      
            <ng-container matColumnDef="star">
              <th mat-header-cell *matHeaderCellDef> </th>
              <td mat-cell *matCellDef="let element" [ngStyle]="{'height': !isMobile ? '100px' : ''}"> 
                <button mat-icon-button [matMenuTriggerFor]="menu" [matMenuTriggerData]="{element:element}">
                  <mat-icon>more_vert</mat-icon>
              </button>
              </td>
            </ng-container>
      
            <tr mat-header-row style="background: #2196F3;" *matHeaderRowDef="displayedColumns"></tr>
            <tr [ngClass]="!isMobile ? 'trForNotMobile' : ''" mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      
          </table>
        
          <div class="no-results text-application" [style.display]="dataSource.data.length == 0 ? '' : 'none'">
            No results
          </div>
        
          <mat-paginator 
            [pageSizeOptions]="[4]"
            showFirstLastButtons 
            aria-label="Select page of periodic elements">
          </mat-paginator>
        </div>
      </div>
          
      <mat-menu #menu="matMenu">
        <ng-template matMenuContent let-link="element">

          <button
            *ngIf="dataUserConnected.roleUpdateFile" 
            type="button"
            mat-menu-item
            (click)="editLink(link)"
            class="text-application">
            <mat-icon style="color: #9C27B0" aria-label="Edit">edit</mat-icon>
            <span>Edit</span>
          </button>

          <button
            type="button"
            *ngIf="link.path"  
            mat-menu-item
            class="text-application">
            <mat-icon style="color: #283593;">remove_red_eye</mat-icon>
            <a href="{{ link.path }}" target="_blank" style="text-decoration: none;">
              <span style="color: black !important;">Watch</span>
            </a>  
          </button>

          <button 
            *ngIf="dataUserConnected.roleDeleteFile" 
            type="button" 
            mat-menu-item
            (click)="openDeleteLinkModal(link, contentDeleteLink)" 
            class="text-application">
            <mat-icon style="color: #f44336;" aria-label="Delete">delete</mat-icon>
            <span>Delete</span>
          </button>

          <button 
            type="button"
            mat-menu-item
            (click)="shareLink(link)"
            class="text-application">
            <mat-icon style="color: #ff4081;">share</mat-icon>
            <span>share</span>                        
          </button>
      
        </ng-template>
      </mat-menu>

    </div>
  </div>

</ng-template>

<ng-template #contentDeleteLink let-modal let-c="close" let-d="dismiss">

  <div mat-dialog-title class="dialog-title">
    <h2 class="text-application">Are you sure ?</h2>
  </div>

  <div mat-dialog-content>
    <div [ngClass]="isMobile ? 'gridForDeleteInMobile' : 'gridForDelete'" class="text-application">
      <div><span>Content:</span></div>
      <div>{{ linkToDelete.content }}</div>
    </div>
  </div>

  <br>

  <div class="row justify-content-center" mat-dialog-actions>
      <button 
          mat-button 
          type="button" 
          [mat-dialog-close]="1" 
          (click)="confirmDelete()" 
          style="background:rgb(221, 51, 51);color: white;" 
          class="text-application">
          Delete
      </button>

      <button 
          mat-button 
          type="button" 
          (click)="close()" 
          tabindex="-1" 
          style="background:#607D8B;color: white;" 
          class="text-application">
          Cancel
      </button>
  </div>

</ng-template>
